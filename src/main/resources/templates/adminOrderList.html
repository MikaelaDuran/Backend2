<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Web Shop with Orders</title>
    <script src="../static/js/Cart.js"></script>
    <link rel="stylesheet" href="../static/css/style.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
</head>
<body>
<header>
    <div class="header-banner text-center bg-light p-2" id="loginStatus">
        Admin Logged in
    </div>
    
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container-fluid">
            <img src="images/logoipsum-361.svg" alt="Logo" width="50" height="50" class="d-inline-block align-text-top"/>
            <a class="navbar-brand ms-3" href="index.html">Fake Store API Collection</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="index.html">Login</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="index.html">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="#ordersSection">Orders</a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">Categories</a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="../static/products.html">All Products</a></li>
                            <li><a class="dropdown-item" href="../static/products.html?category=men">Mens Clothing</a></li>
                            <li><a class="dropdown-item" href="../static/products.html?category=women">Womans Clothing</a></li>
                            <li><a class="dropdown-item" href="../static/products.html?category=jewelery">Jewelery</a></li>
                            <li><a class="dropdown-item" href="../static/products.html?category=electronics">Electronics</a></li>
                            <li><hr class="dropdown-divider" /></li>
                            <li>
                                <a class="dropdown-item" href="../static/AboutUs.html">About Us</a>
                                <a class="dropdown-item" href="../static/AboutUs.html#contactID">Contact Us</a>
                            </li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
</header>

<br /><br /><br /><br />

<section id="ordersSection" class="container my-5">
    <h2 class="mb-4">Orders</h2>
    
    <div th:if="${#lists.isEmpty(orders)}" class="alert alert-info">
        No orders found.
    </div>
    
    <div th:if="${!#lists.isEmpty(orders)}">
        <table class="table table-striped">
            <thead class="table-dark">
            <tr>
                <th>Order ID</th>
                <th>User ID</th>
                <th>User name</th>
                <th>Created At</th>
                <th>Items Count</th>
                <th>Action</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="order : ${orders}">
                <td th:text="${order.orderId}">1</td>
                <td th:text="${order.user.userId}">1234</td>
                <td th:text="${order.user.username}">user@mail.com</td>
                <td th:text="${#temporals.format(order.createdAt, 'dd-MM-yyyy HH:mm')}">01-01-2025 12:00</td>
                <td th:text="${#lists.size(order.orderItems)}">0</td>
                <td>
                    <button class='btn btn-secondary btn-sm me-2'
                            th:onclick="'showOrder(' + ${order.orderId} + ')'">
                        Details
                    </button>
                    <form th:action="@{/admin/orders/{id}/delete(id=${order.orderId})}"
                          method="post"
                          style="display: inline;"
                          onsubmit="return confirm('Are you sure you want to delete this order?')">
                        <button type="submit" class='btn btn-danger btn-sm'>Delete</button>
                    </form>
                </td>
            </tr>
            </tbody>
        </table>
    </div>
</section>


<footer class="bg-light text-center text-white">
    <div class="container p-4 pb-0">
        <h2 class="text-secondary">Fake Store API Collection</h2>
        <p class="text-secondary text-center">
            This webshop was created by <br />
            Kieran, Mikaela, Hani & Julia <br />
            as part of our Backend 2 course
        </p>
    </div>
    <div class="text-center p-3 footer">Â© 2025 Copyright</div>
</footer>


<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="../static/js/product.js"></script>

<script th:inline="javascript">
    var orders = /*[[${orders}]]*/ [];
    
    function showOrder(orderId) {
        const orderModal = new bootstrap.Modal(document.getElementById('orderModal'));
        const orderModalBody = document.getElementById('orderModalBody');
        orderModalBody.innerHTML = "<p>Loading...</p>";

        try {
            let order = orders.find(o => o.orderId === orderId);
            if (!order) {
                throw new Error('Order not found');
            }

            let orderItemsHtml = '';
            if (order.orderItems && order.orderItems.length > 0) {
                orderItemsHtml = '<h6>Order Items:</h6><ul class="list-group">';
                order.orderItems.forEach(item => {
                    orderItemsHtml += `
                <li class="list-group-item d-flex justify-content-between align-items-center">
                  <div>
                    <strong>${item.productName || 'Product'}</strong><br>
                    <small class="text-muted">Quantity: ${item.quantity}</small>
                  </div>
                  <span class="badge bg-primary rounded-pill">$${item.price || '0.00'}</span>
                </li>
              `;
                });
                orderItemsHtml += '</ul>';
            } else {
                orderItemsHtml = '<p><em>No items in this order</em></p>';
            }

            orderModalBody.innerHTML = `
            <p><strong>Order ID:</strong> ${order.orderId}</p>
            <p><strong>User ID:</strong> ${order.user.userId}</p>
            <p><strong>Username:</strong> ${order.user.username}</p>
            <hr>
            ${orderItemsHtml}
          `;
        } catch (error) {
            orderModalBody.innerHTML = `<p class="text-danger">Error loading order details: ${error.message}</p>`;
            console.error(error);
        }
        orderModal.show();
    }
</script>

<div class="modal fade" id="orderModal" tabindex="-1" aria-labelledby="orderModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="orderModalLabel">Order Details</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="orderModalBody">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
</body>
</html>